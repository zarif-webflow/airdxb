import{g as o,a as d,s as l}from"./chunks/util.js";const g=c=>{l(c,{display:"none",width:"1px",height:"1px",padding:"0px",margin:"-1px",overflow:"hidden",clip:"rect(0px, 0px, 0px, 0px)","white-space":"nowrap","overflow-wrap":"normal"})},u=new Set;class h{constructor(t){Object.defineProperty(this,"rootElement",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"nativeSelect",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"trigger",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"triggerValue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"content",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"viewport",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fragment",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"optionItems",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"elementIds",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"isContentRectSet",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"isOpen",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"position",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"triggerRect",{enumerable:!0,configurable:!0,writable:!0,value:{offsetTop:0,offsetLeft:0,width:0,height:0}}),Object.defineProperty(this,"contentRect",{enumerable:!0,configurable:!0,writable:!0,value:{offsetTop:0,offsetLeft:0,width:0,height:0}}),this.rootElement=t,this.fragment=document.createDocumentFragment(),this.trigger=o("[data-st-trigger]",this.rootElement),this.triggerValue=o("[data-st-value]",this.trigger),this.content=o("[data-st-content]",this.rootElement),this.viewport=o("[data-st-viewport]",this.rootElement),this.optionItems=this.getOptionItems(),this.elementIds=this.generateElementIds(),this.nativeSelect=this.setupNativeSelect(),this.setElementRects(),this.fragment.appendChild(this.content),this.initialAriaSetup(),this.setupEventListeners()}generateId(){for(;;){const t=Math.random().toString(36).substring(2,8);if(!u.has(t))return t}}generateElementIds(){const t=`st--${this.generateId()}`;let e=this.rootElement.id;e===""&&(e=t,this.rootElement.id=e);const i={id:t,content:`${t}--content`,trigger:`${t}--trigger`,viewport:`${t}--viewport`,rootElement:e};return this.content.id=i.content,this.trigger.id=i.trigger,this.viewport.id=i.viewport,i}getOptionItems(){const t={},e=d("[data-st-option]",this.rootElement);for(const i of e){const n=i.getAttribute("value")??i.textContent?.trim();if(n===void 0)throw new Error("Option element must have a value or a text content!");i.setAttribute("value",n),t[n]={element:i,isDefault:i.hasAttribute("selected")}}return t}setupNativeSelect(){let t=!1;const e=document.createElement("select"),i=this.rootElement.getAttribute("name");i&&(e.name=i),e.ariaHidden="true",e.tabIndex=-1;const n=document.createDocumentFragment();for(const s of Object.keys(this.optionItems)){const r=this.optionItems[s]?.isDefault,a=document.createElement("option");a.value=s,a.textContent=s,r&&!t&&(a.setAttribute("selected",""),t=!0),n.appendChild(a)}return e.appendChild(n),g(e),this.rootElement.appendChild(e),e}initialAriaSetup(){this.trigger.setAttribute("type","button"),this.trigger.tagName!=="BUTTON"&&(this.trigger.role="button"),this.trigger.ariaHasPopup="listbox",this.trigger.ariaExpanded="false",this.trigger.setAttribute("aria-controls",this.elementIds.content),this.trigger.addEventListener("click",()=>{this.openModal()}),this.content.role="listbox",this.content.tabIndex=0,this.content.setAttribute("aria-labelledby",this.elementIds.trigger),this.content.ariaOrientation="vertical",this.viewport.role="presentation";for(const t of Object.values(this.optionItems))t.element.role="option",t.element.tabIndex=-1,t.element.ariaSelected=t.isDefault?"true":"false",t.element.dataset.selected=t.isDefault?"true":"false",t.element.querySelectorAll("svg").forEach(e=>{e.ariaHidden="true"}),t.element.addEventListener("click",()=>{this.selectOption(t.element)})}removeSelection(){for(const[t,e]of Object.entries(this.optionItems)){if(t===""){this.triggerValue.textContent=e.element.textContent,e.element.dataset.selected="false",e.element.ariaSelected="false";continue}e.element.ariaSelected="false",e.element.dataset.selected="false",e.element.classList.remove("selected")}this.nativeSelect.value=""}selectOption(t){this.removeSelection();const e=t.getAttribute("value");if(e===null)throw new Error("Option element must have a value!");this.nativeSelect.value=e,this.triggerValue.textContent=t.textContent,t.ariaSelected="true",t.dataset.selected="true",t.classList.add("selected"),this.closeModal()}closeModal(){this.fragment.appendChild(this.content),this.isOpen=!1,document.body.removeEventListener("click",this.clickOutsideCallback)}clickOutsideCallback(t){const e=t.target;this.content.isSameNode(e)||this.content.contains(e)||this.rootElement.isSameNode(e)||this.rootElement.contains(e)||this.closeModal()}openModal(){document.body.appendChild(this.content),this.isOpen=!0,this.setModalPosition(),document.body.addEventListener("click",this.clickOutsideCallback)}setElementRects(){const t=this.trigger.getBoundingClientRect(),e=this.content.getBoundingClientRect();this.triggerRect.offsetTop=this.trigger.offsetTop,this.triggerRect.offsetLeft=this.trigger.offsetLeft,this.triggerRect.width=t.width,this.triggerRect.height=t.height,this.contentRect.offsetTop=this.triggerRect.offsetTop+this.triggerRect.height,this.contentRect.offsetLeft=this.triggerRect.offsetLeft,this.contentRect.width=e.width,this.contentRect.height=e.height,l(this.content,{position:"absolute","min-width":`${this.contentRect.width}px`,left:`${this.contentRect.offsetLeft}px`})}setModalPosition(){const{offsetTop:t,height:e}=this.contentRect,{height:i,offsetTop:n}=this.triggerRect,s=this.trigger.getBoundingClientRect().top+i+e+80,r=window.innerHeight>s?"bottom":"top";this.position!==void 0&&r===this.position||(this.position=r,r==="bottom"?l(this.content,{top:`${t}px`,transform:"translateX(0px) translateY(0px)"}):l(this.content,{top:`${n-e}px`,transform:"translateX(0px) translateY(0px)"}))}setupEventListeners(){const t=()=>{this.isOpen&&this.setModalPosition()};new IntersectionObserver(e=>{for(const i of e){if(i.isIntersecting){window.addEventListener("scroll",t);return}window.removeEventListener("scroll",t)}},{root:null,threshold:0}).observe(this.trigger)}}new h(o("[data-st-root]")),new h(o("[data-st-root2]"));
