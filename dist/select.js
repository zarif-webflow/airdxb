import{g as a,a as d,s as r}from"./chunks/util.js";const c=new Set;class g{constructor(t){Object.defineProperty(this,"rootElement",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"nativeSelect",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"trigger",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"triggerValue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"content",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"viewport",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fragment",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"optionItems",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"elementIds",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"defaultOptionIndex",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"selectedOptionIndex",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"highlightedOptionIndex",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"isOpen",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"position",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"triggerRect",{enumerable:!0,configurable:!0,writable:!0,value:{offsetTop:0,offsetLeft:0,width:0,height:0}}),Object.defineProperty(this,"contentRect",{enumerable:!0,configurable:!0,writable:!0,value:{offsetTop:0,offsetLeft:0,width:0,height:0}}),Object.defineProperty(this,"clickOutsideCallback",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"keyboardNavigationCallback",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.rootElement=t,this.fragment=document.createDocumentFragment(),this.trigger=a("[data-st-trigger]",this.rootElement),this.triggerValue=a("[data-st-value]",this.trigger),this.content=a("[data-st-content]",this.rootElement),this.viewport=a("[data-st-viewport]",this.rootElement),this.elementIds=this.generateElementIds(),this.optionItems=this.getOptionItems(),this.nativeSelect=this.setupNativeSelect(),this.setElementRects(),this.fragment.appendChild(this.content),this.initialSetup(),this.clickOutsideCallback=e=>{const i=e.target;this.content.isSameNode(i)||this.content.contains(i)||this.trigger.isSameNode(i)||this.trigger.contains(i)||this.closeModal()},this.keyboardNavigationCallback=e=>{if(e.key==="Enter"||e.key===" "){if(e.preventDefault(),this.highlightedOptionIndex===void 0)return;this.selectOption(this.highlightedOptionIndex),this.closeModal()}e.key==="ArrowDown"&&(e.preventDefault(),this.highlightOption(this.highlightedOptionIndex===void 0||this.highlightedOptionIndex>=this.optionItems.length-1?0:this.highlightedOptionIndex+1,"focus")),e.key==="ArrowUp"&&(e.preventDefault(),this.highlightOption(this.highlightedOptionIndex===void 0||this.highlightedOptionIndex<=0?this.optionItems.length-1:this.highlightedOptionIndex-1,"focus")),e.key==="Escape"&&(e.preventDefault(),this.closeModal())},this.scrollAwareness(),this.resizeAwareness()}generateId(){for(;;){const t=Math.random().toString(36).substring(2,8);if(!c.has(t))return t}}generateElementIds(){const t=`st--${this.generateId()}`;let e=this.rootElement.id;e===""&&(e=t,this.rootElement.id=e);const i={id:t,content:`${t}--content`,trigger:`${t}--trigger`,viewport:`${t}--viewport`,rootElement:e};return this.content.id=i.content,this.trigger.id=i.trigger,this.viewport.id=i.viewport,i}getOptionItems(){let t=!1;const e=[],i=d("[data-st-option]",this.rootElement);for(let n=0;n<i.length;n++){const o=i[n],s=o.getAttribute("data-value")??o.textContent?.trim();if(s===void 0)throw new Error("Option element must have a value or a text content!");o.setAttribute("data-value",s),o.setAttribute("id",`${this.elementIds.id}--option-${n}`);const l=o.hasAttribute("selected")&&!t;e.push({element:o,value:s}),l&&(t=!0,this.defaultOptionIndex=n,this.triggerValue.textContent=o.textContent?.trim()||null,this.triggerValue.setAttribute("data-selected",""))}return e}setupNativeSelect(){const t=document.createElement("select"),e=this.rootElement.getAttribute("data-name");e&&(t.name=e);const i=this.rootElement.getAttribute("data-aria");(i==="inert"||!this.rootElement.hasAttribute("data-aria"))&&t.setAttribute("inert",""),i==="hidden"&&t.setAttribute("aria-hidden","true"),t.tabIndex=-1,this.rootElement.hasAttribute("data-required")&&(t.required=!0);const n=document.createDocumentFragment();let o=!1;for(let s=0;s<this.optionItems.length;s++){const{value:l}=this.optionItems[s],h=document.createElement("option");h.value=l,h.textContent=l,s===this.defaultOptionIndex&&!o&&(h.setAttribute("selected",""),o=!0),n.appendChild(h)}return t.appendChild(n),r(this.rootElement,{position:"relative"}),r(t,{width:"0px",height:"0px",padding:"0px",margin:"0px",overflow:"hidden",position:"absolute",bottom:"0px",left:"50%",transform:"translateX(-50%)",clip:"rect(0px, 0px, 0px, 0px)","white-space":"nowrap","overflow-wrap":"normal"}),!o&&(t.value=""),this.rootElement.appendChild(t),t}initialSetup(){this.trigger.setAttribute("type","button"),this.trigger.tagName!=="BUTTON"&&(this.trigger.role="button"),this.trigger.ariaHasPopup="listbox",this.trigger.ariaExpanded="false",this.trigger.setAttribute("aria-controls",this.elementIds.content),this.trigger.addEventListener("click",()=>{this.openModal()}),this.content.role="listbox",this.content.tabIndex=0,this.content.setAttribute("aria-labelledby",this.elementIds.trigger),this.content.ariaOrientation="vertical",this.rootElement.hasAttribute("data-required")&&(this.content.ariaRequired="true"),r(this.content,{position:"absolute","min-width":"var(--st-content-min-w)",left:"var(--st-content-left)",top:"var(--st-content-top)"}),this.viewport.role="presentation";for(let t=0;t<this.optionItems.length;t++){const e=this.optionItems[t];e.element.role="option",e.element.tabIndex=-1,e.element.ariaSelected=t===this.defaultOptionIndex?"true":"false",e.element.dataset.selected=t===this.defaultOptionIndex?"true":"false",e.element.querySelectorAll("svg").forEach(i=>{i.ariaHidden="true"}),e.element.addEventListener("click",()=>{this.selectOption(t)}),e.element.addEventListener("mouseenter",()=>{this.highlightOption(t)}),e.element.addEventListener("mouseleave",()=>{this.dehighlightOptions()})}}removeSelection(){for(const{value:t,element:e}of this.optionItems){if(this.triggerValue.removeAttribute("data-selected"),t===""){this.triggerValue.textContent=e.textContent,e.dataset.selected="false",e.ariaSelected="false";continue}e.dataset.selected="false",e.ariaSelected="false",e.classList.remove("selected")}this.nativeSelect.value=""}selectOption(t){const e=this.optionItems[t].element;this.removeSelection(),this.selectedOptionIndex=t,this.highlightOption(t,"hover");const i=e.getAttribute("data-value");if(i===null)throw new Error("Option element must have a value!");i?(this.nativeSelect.value=i,this.triggerValue.setAttribute("data-selected","")):(this.nativeSelect.removeAttribute("value"),this.triggerValue.removeAttribute("data-selected")),this.triggerValue.textContent=e.textContent?.trim()||null,e.ariaSelected="true",e.dataset.selected="true",e.classList.add("selected"),this.closeModal()}dehighlightOptions(){if(this.highlightedOptionIndex!==void 0){const t=this.optionItems[this.highlightedOptionIndex];t.element.classList.remove("focused","hovered"),t.element.removeAttribute("data-focused"),t.element.removeAttribute("data-hovered"),t.element.blur()}this.highlightedOptionIndex=void 0,this.content.removeAttribute("aria-activedescendant")}highlightOption(t,e="hover"){const i=this.optionItems[t].element;this.dehighlightOptions(),e==="focus"&&(i.classList.add("focused"),i.setAttribute("data-focused","true"),i.focus()),e==="hover"&&(i.classList.add("hovered"),i.setAttribute("data-hovered","true"));const n=i.getAttribute("id");n!==null&&this.content.setAttribute("aria-activedescendant",n),this.highlightedOptionIndex=t}closeModal(){this.fragment.appendChild(this.content),this.isOpen=!1,this.trigger.ariaExpanded="false",document.body.removeEventListener("click",this.clickOutsideCallback),document.removeEventListener("keydown",this.keyboardNavigationCallback)}openModal(){document.body.appendChild(this.content),this.isOpen=!0,this.trigger.ariaExpanded="true",this.selectedOptionIndex!==void 0&&this.highlightOption(this.selectedOptionIndex),this.setModalPosition(),document.body.addEventListener("click",this.clickOutsideCallback),document.addEventListener("keydown",this.keyboardNavigationCallback)}setElementRects(){const t=this.trigger.getBoundingClientRect(),e=this.content.getBoundingClientRect();this.triggerRect.offsetTop=t.top+globalThis.scrollY,this.triggerRect.offsetLeft=t.left+globalThis.scrollX,this.triggerRect.width=t.width,this.triggerRect.height=t.height,this.contentRect.offsetTop=t.top+globalThis.scrollY+this.triggerRect.height,this.contentRect.offsetLeft=t.left+globalThis.scrollX,this.contentRect.width=e.width,this.contentRect.height=e.height,r(this.content,{"--st-content-min-w":`${Math.max(this.contentRect.width,this.triggerRect.width)}px`,"--st-content-left":`${this.contentRect.offsetLeft}px`})}setModalPosition(){const{offsetTop:t,height:e}=this.contentRect,{height:i,offsetTop:n}=this.triggerRect,o=this.trigger.getBoundingClientRect().top+i+e+80,s=window.innerHeight>o?"bottom":"top";this.position=s,this.content.setAttribute("data-position",s),s==="bottom"?r(this.content,{"--st-content-top":`${t}px`}):r(this.content,{"--st-content-top":`${n-e}px`})}scrollAwareness(){const t=()=>{this.isOpen&&this.setModalPosition()};new IntersectionObserver(e=>{for(const i of e){if(i.isIntersecting){window.addEventListener("scroll",t);return}window.removeEventListener("scroll",t)}},{root:null,threshold:0}).observe(this.trigger)}resizeAwareness(){const t=()=>{this.isOpen&&(this.setElementRects(),this.setModalPosition())};new ResizeObserver(e=>{for(const i of e)t()}).observe(document.body)}}new g(a("[data-st-root]"));
